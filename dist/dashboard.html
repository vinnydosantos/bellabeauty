<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Admin - Bella Beauty</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f5f7fa;
            color: #333;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            position: relative;
        }

        .header h1 {
            font-size: 28px;
            margin-bottom: 5px;
        }

        .chatbot-link {
            position: absolute;
            top: 20px;
            right: 30px;
            background: rgba(255,255,255,0.2);
            color: white;
            padding: 10px 20px;
            border: 2px solid rgba(255,255,255,0.3);
            border-radius: 25px;
            text-decoration: none;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .chatbot-link:hover {
            background: white;
            color: #667eea;
            transform: translateY(-2px);
        }

        .api-status {
            margin-top: 10px;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
            display: inline-block;
        }

        .api-status.configured {
            background: rgba(40, 167, 69, 0.2);
            color: #28a745;
        }

        .api-status.not-configured {
            background: rgba(220, 53, 69, 0.2);
            color: #dc3545;
        }

        .main-container {
            max-width: 1200px;
            margin: 30px auto;
            padding: 0 20px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            border-left: 5px solid #667eea;
            position: relative;
            transition: transform 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-number {
            font-size: 36px;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 5px;
        }

        .stat-label {
            color: #7f8c8d;
            font-size: 14px;
            text-transform: uppercase;
        }

        .quick-actions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        .btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 15px 20px;
            border-radius: 10px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }

        .btn-success {
            background: linear-gradient(135deg, #28a745, #20c997);
        }

        .btn-warning {
            background: linear-gradient(135deg, #ffc107, #fd7e14);
            color: #212529;
        }

        .btn-danger {
            background: linear-gradient(135deg, #dc3545, #e83e8c);
        }

        .panel {
            background: white;
            border-radius: 15px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            margin-bottom: 30px;
            overflow: hidden;
        }

        .panel-header {
            background: linear-gradient(135deg, #ff6b9d, #c44569);
            color: white;
            padding: 20px 25px;
            font-size: 18px;
            font-weight: 600;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .panel-content {
            padding: 25px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2c3e50;
        }

        .form-input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s ease;
        }

        .form-input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }

        .table th,
        .table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }

        .table th {
            background: #f8f9fa;
            font-weight: 600;
        }

        .table tr:hover {
            background: #f8f9fa;
        }

        .status-badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .status-pending {
            background: #fff3cd;
            color: #856404;
        }

        .status-confirmed {
            background: #d1ecf1;
            color: #0c5460;
        }

        .status-completed {
            background: #d4edda;
            color: #155724;
        }

        .status-cancelled {
            background: #f8d7da;
            color: #721c24;
        }

        .action-btn {
            padding: 6px 12px;
            border: none;
            border-radius: 6px;
            font-size: 12px;
            cursor: pointer;
            margin: 0 2px;
            color: white;
            transition: all 0.2s ease;
        }

        .action-btn:hover {
            transform: translateY(-1px);
        }

        .btn-edit {
            background: #17a2b8;
        }

        .btn-delete {
            background: #dc3545;
        }

        .btn-confirm {
            background: #28a745;
        }

        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            display: none;
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .modal.show {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 15px;
            padding: 30px;
            width: 100%;
            max-width: 500px;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-header {
            font-size: 20px;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #7f8c8d;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #28a745;
            color: white;
            padding: 15px 20px;
            border-radius: 8px;
            z-index: 2000;
            transform: translateX(400px);
            transition: transform 0.3s ease;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.error {
            background: #dc3545;
        }

        .notification.warning {
            background: #ffc107;
            color: #212529;
        }

        .filter-bar {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
        }

        .filter-item {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .filter-item label {
            font-size: 12px;
            font-weight: 600;
            color: #6c757d;
        }

        .filter-item select,
        .filter-item input {
            padding: 8px 12px;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            font-size: 14px;
        }

        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #6c757d;
        }

        @media (max-width: 768px) {
            .header {
                padding: 15px 20px;
            }
            
            .chatbot-link {
                position: static;
                margin-top: 15px;
                display: block;
                text-align: center;
            }
            
            .main-container {
                padding: 0 15px;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üíá‚Äç‚ôÄÔ∏è Dashboard Administrativo</h1>
        <p>Gerencie seu sal√£o de beleza</p>
        <a href="#" class="chatbot-link" onclick="openChatbot()">üí¨ Abrir Chatbot</a>
        <div class="api-status" id="apiStatus">
            üîë Configurando API...
        </div>
    </div>

    <div class="main-container">
        <!-- Estat√≠sticas -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-number" id="totalReservations">0</div>
                <div class="stat-label">Total de Reservas</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="totalServices">0</div>
                <div class="stat-label">Servi√ßos Ativos</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="totalPromotions">0</div>
                <div class="stat-label">Promo√ß√µes Ativas</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="pendingReservations">0</div>
                <div class="stat-label">Pendentes</div>
            </div>
        </div>

        <!-- A√ß√µes R√°pidas -->
        <div class="quick-actions">
            <button class="btn" onclick="openApiModal()">üîë Configurar API Claude</button>
            <button class="btn btn-success" onclick="openReservationModal()">üìÖ Nova Reserva</button>
            <button class="btn btn-warning" onclick="openServiceModal()">‚ú® Novo Servi√ßo</button>
            <button class="btn" onclick="openPromotionModal()">üéâ Nova Promo√ß√£o</button>
        </div>

        <!-- Configura√ß√µes do Sal√£o -->
        <div class="panel">
            <div class="panel-header">
                <span>‚öôÔ∏è Configura√ß√µes do Sal√£o</span>
            </div>
            <div class="panel-content">
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">üè™ Nome do Sal√£o</label>
                        <input type="text" class="form-input" id="salonName" placeholder="Nome do seu sal√£o">
                    </div>
                    <div class="form-group">
                        <label class="form-label">üìû Telefone/WhatsApp</label>
                        <input type="text" class="form-input" id="salonPhone" placeholder="(11) 99999-9999">
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">üìç Endere√ßo</label>
                    <input type="text" class="form-input" id="salonAddress" placeholder="Endere√ßo completo">
                </div>
                <button class="btn btn-success" onclick="saveGeneralConfig()">üíæ Salvar Configura√ß√µes</button>
            </div>
        </div>

        <!-- Reservas -->
        <div class="panel">
            <div class="panel-header">
                <span>üìÖ Gerenciar Reservas</span>
                <span id="reservationCount" style="opacity: 0.8; font-size: 14px;">0 reservas</span>
            </div>
            <div class="panel-content">
                <div class="filter-bar">
                    <div class="filter-item">
                        <label>Status</label>
                        <select id="statusFilter" onchange="filterReservations()">
                            <option value="">Todos</option>
                            <option value="pending">Pendente</option>
                            <option value="confirmed">Confirmada</option>
                            <option value="completed">Realizada</option>
                            <option value="cancelled">Cancelada</option>
                        </select>
                    </div>
                    <div class="filter-item">
                        <label>Data</label>
                        <input type="date" id="dateFilter" onchange="filterReservations()">
                    </div>
                    <div class="filter-item">
                        <label>Cliente</label>
                        <input type="text" id="clientFilter" placeholder="Nome ou telefone" onkeyup="filterReservations()">
                    </div>
                </div>
                <div style="overflow-x: auto;">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Cliente</th>
                                <th>Servi√ßo</th>
                                <th>Data/Hora</th>
                                <th>Status</th>
                                <th>A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody id="reservationsTable">
                            <tr><td colspan="5" class="empty-state">
                                <div>üìÖ Nenhuma reserva encontrada</div>
                                <div style="font-size: 12px; margin-top: 5px;">As reservas aparecer√£o aqui automaticamente</div>
                            </td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Servi√ßos -->
        <div class="panel">
            <div class="panel-header">
                <span>‚ú® Servi√ßos Oferecidos</span>
                <span id="serviceCount" style="opacity: 0.8; font-size: 14px;">0 servi√ßos</span>
            </div>
            <div class="panel-content">
                <div style="overflow-x: auto;">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Servi√ßo</th>
                                <th>Pre√ßo</th>
                                <th>Descri√ß√£o</th>
                                <th>A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody id="servicesTable">
                            <tr><td colspan="4" class="empty-state">
                                <div>‚ú® Carregando servi√ßos...</div>
                            </td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Promo√ß√µes -->
        <div class="panel">
            <div class="panel-header">
                <span>üéâ Promo√ß√µes Ativas</span>
                <span id="promotionCount" style="opacity: 0.8; font-size: 14px;">0 promo√ß√µes</span>
            </div>
            <div class="panel-content">
                <div style="overflow-x: auto;">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Promo√ß√£o</th>
                                <th>Desconto</th>
                                <th>Validade</th>
                                <th>A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody id="promotionsTable">
                            <tr><td colspan="4" class="empty-state">
                                <div>üéâ Nenhuma promo√ß√£o ativa</div>
                                <div style="font-size: 12px; margin-top: 5px;">Crie promo√ß√µes para atrair mais clientes</div>
                            </td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal API -->
    <div class="modal" id="apiModal">
        <div class="modal-content">
            <div class="modal-header">
                <span>üîë Configurar API do Claude</span>
                <button class="close-modal" onclick="closeModal('apiModal')">&times;</button>
            </div>
            <div class="form-group">
                <label class="form-label">Chave da API</label>
                <input type="password" class="form-input" id="apiKey" placeholder="sk-ant-...">
                <div style="margin-top: 8px; font-size: 12px; color: #666;">
                    Obtenha sua API key em: <a href="https://console.anthropic.com" target="_blank">console.anthropic.com</a>
                </div>
            </div>
            <button class="btn btn-success" onclick="saveApiKey()">üíæ Salvar API Key</button>
        </div>
    </div>

    <!-- Modal Reserva -->
    <div class="modal" id="reservationModal">
        <div class="modal-content">
            <div class="modal-header">
                <span>üìÖ Nova Reserva</span>
                <button class="close-modal" onclick="closeModal('reservationModal')">&times;</button>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label class="form-label">Nome</label>
                    <input type="text" class="form-input" id="reservationName">
                </div>
                <div class="form-group">
                    <label class="form-label">Telefone</label>
                    <input type="text" class="form-input" id="reservationPhone">
                </div>
            </div>
            <div class="form-group">
                <label class="form-label">Servi√ßo</label>
                <select class="form-input" id="reservationService">
                    <option value="">Selecione um servi√ßo</option>
                </select>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label class="form-label">Data</label>
                    <input type="date" class="form-input" id="reservationDate">
                </div>
                <div class="form-group">
                    <label class="form-label">Hor√°rio</label>
                    <input type="time" class="form-input" id="reservationTime">
                </div>
            </div>
            <div class="form-group">
                <label class="form-label">Observa√ß√µes</label>
                <textarea class="form-input" id="reservationNotes" rows="3" placeholder="Observa√ß√µes ou pedidos especiais"></textarea>
            </div>
            <button class="btn btn-success" onclick="saveReservation()">üíæ Criar Reserva</button>
        </div>
    </div>

    <!-- Modal Servi√ßo -->
    <div class="modal" id="serviceModal">
        <div class="modal-content">
            <div class="modal-header">
                <span>‚ú® Novo Servi√ßo</span>
                <button class="close-modal" onclick="closeModal('serviceModal')">&times;</button>
            </div>
            <div class="form-group">
                <label class="form-label">Nome do Servi√ßo</label>
                <input type="text" class="form-input" id="serviceName" placeholder="Ex: Corte Feminino">
            </div>
            <div class="form-group">
                <label class="form-label">Pre√ßo</label>
                <input type="text" class="form-input" id="servicePrice" placeholder="Ex: R$ 45-80">
            </div>
            <div class="form-group">
                <label class="form-label">Descri√ß√£o</label>
                <textarea class="form-input" id="serviceDescription" rows="3" placeholder="Descreva o servi√ßo oferecido"></textarea>
            </div>
            <button class="btn btn-success" onclick="saveService()">üíæ Criar Servi√ßo</button>
        </div>
    </div>

    <!-- Modal Promo√ß√£o -->
    <div class="modal" id="promotionModal">
        <div class="modal-content">
            <div class="modal-header">
                <span>üéâ Nova Promo√ß√£o</span>
                <button class="close-modal" onclick="closeModal('promotionModal')">&times;</button>
            </div>
            <div class="form-group">
                <label class="form-label">T√≠tulo da Promo√ß√£o</label>
                <input type="text" class="form-input" id="promotionTitle" placeholder="Ex: Desconto de Ver√£o">
            </div>
            <div class="form-group">
                <label class="form-label">Desconto</label>
                <input type="text" class="form-input" id="promotionDiscount" placeholder="Ex: 20% OFF ou R$ 10 de desconto">
            </div>
            <div class="form-group">
                <label class="form-label">Descri√ß√£o</label>
                <textarea class="form-input" id="promotionDescription" rows="3" placeholder="Descreva a promo√ß√£o e condi√ß√µes"></textarea>
            </div>
            <div class="form-group">
                <label class="form-label">Data Final</label>
                <input type="date" class="form-input" id="promotionEndDate">
            </div>
            <button class="btn btn-success" onclick="savePromotion()">üíæ Criar Promo√ß√£o</button>
        </div>
    </div>

    <!-- Notifica√ß√£o -->
    <div class="notification" id="notification"></div>

    <script>
        // Dados globais
        let salonData = {
            name: "Bella Beauty",
            address: "Rua das Flores, 123 - Centro",
            phone: "(11) 99999-9999",
            services: [
                { name: "Corte feminino", price: "R$ 45-80", description: "Corte personalizado para cabelos femininos" },
                { name: "Corte masculino", price: "R$ 25-35", description: "Corte moderno para cabelos masculinos" },
                { name: "Manicure", price: "R$ 25", description: "Cuidados completos para as unhas das m√£os" },
                { name: "Pedicure", price: "R$ 30", description: "Cuidados completos para os p√©s" },
                { name: "Design de sobrancelhas", price: "R$ 20", description: "Modelagem perfeita das sobrancelhas" }
            ],
            promotions: [],
            reservations: []
        };

        let filteredReservations = [];

        // Inicializar quando p√°gina carregar
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ Iniciando Dashboard Admin...');
            loadData();
            updateAll();
            checkApiStatus();
            
            // Configurar sincroniza√ß√£o autom√°tica
            setInterval(() => {
                syncWithChatbot();
            }, 3000);
        });

        // Carregar dados do localStorage
        function loadData() {
            try {
                const saved = localStorage.getItem('salon_config');
                if (saved) {
                    const parsed = JSON.parse(saved);
                    salonData = { ...salonData, ...parsed };
                    console.log('‚úÖ Dados carregados:', {
                        reservations: salonData.reservations?.length || 0,
                        services: salonData.services?.length || 0,
                        promotions: salonData.promotions?.length || 0
                    });
                }
                
                // Carregar API key
                const apiKey = localStorage.getItem('claude_api_key');
                if (apiKey) {
                    document.getElementById('apiKey').value = apiKey;
                }
            } catch (e) {
                console.error('‚ùå Erro ao carregar dados:', e);
                showNotification('Erro ao carregar dados salvos', 'error');
            }
        }

        // Salvar dados no localStorage
        function saveData() {
            try {
                localStorage.setItem('salon_config', JSON.stringify(salonData));
                localStorage.setItem('last_dashboard_activity', Date.now().toString());
                console.log('üíæ Dados salvos com sucesso');
                return true;
            } catch (e) {
                console.error('‚ùå Erro ao salvar:', e);
                showNotification('Erro ao salvar dados!', 'error');
                return false;
            }
        }

        // Verificar status da API
        function checkApiStatus() {
            const apiKey = localStorage.getItem('claude_api_key');
            const statusElement = document.getElementById('apiStatus');
            
            if (apiKey && apiKey.startsWith('sk-ant-')) {
                statusElement.textContent = 'üü¢ API Configurada';
                statusElement.className = 'api-status configured';
                console.log('‚úÖ API Claude configurada');
            } else {
                statusElement.textContent = 'üî¥ API N√£o Configurada';
                statusElement.className = 'api-status not-configured';
                console.log('‚ö†Ô∏è API Claude n√£o configurada');
            }
        }

        // Atualizar tudo
        function updateAll() {
            updateStats();
            updateTables();
            updateConfigForm();
            updateServiceOptions();
            filteredReservations = salonData.reservations || [];
        }

        // Atualizar estat√≠sticas
        function updateStats() {
            const reservations = salonData.reservations || [];
            const services = salonData.services || [];
            const promotions = salonData.promotions || [];
            const pending = reservations.filter(r => r.status === 'pending').length;

            document.getElementById('totalReservations').textContent = reservations.length;
            document.getElementById('totalServices').textContent = services.length;
            document.getElementById('totalPromotions').textContent = promotions.length;
            document.getElementById('pendingReservations').textContent = pending;

            // Atualizar contadores nos pain√©is
            document.getElementById('reservationCount').textContent = `${reservations.length} reservas`;
            document.getElementById('serviceCount').textContent = `${services.length} servi√ßos`;
            document.getElementById('promotionCount').textContent = `${promotions.length} promo√ß√µes`;
        }

        // Atualizar formul√°rio de configura√ß√µes
        function updateConfigForm() {
            document.getElementById('salonName').value = salonData.name || '';
            document.getElementById('salonAddress').value = salonData.address || '';
            document.getElementById('salonPhone').value = salonData.phone || '';
        }

        // Atualizar tabelas
        function updateTables() {
            updateReservationsTable();
            updateServicesTable();
            updatePromotionsTable();
        }

        // Atualizar tabela de reservas
        function updateReservationsTable() {
            const tbody = document.getElementById('reservationsTable');
            const reservations = filteredReservations.length > 0 ? filteredReservations : salonData.reservations || [];
            
            if (reservations.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5" class="empty-state"><div>üìÖ Nenhuma reserva encontrada</div><div style="font-size: 12px; margin-top: 5px;">As reservas aparecer√£o aqui automaticamente</div></td></tr>';
                return;
            }
            
            tbody.innerHTML = '';
            
            // Ordenar por data mais recente primeiro
            const sortedReservations = [...reservations].sort((a, b) => {
                const dateA = new Date(a.date + ' ' + a.time);
                const dateB = new Date(b.date + ' ' + b.time);
                return dateB - dateA;
            });
            
            sortedReservations.forEach(reservation => {
                const date = new Date(reservation.date).toLocaleDateString('pt-BR');
                const statusClass = `status-${reservation.status}`;
                const statusText = {
                    'pending': 'Pendente',
                    'confirmed': 'Confirmada',
                    'completed': 'Realizada',
                    'cancelled': 'Cancelada'
                };
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>
                        <div style="font-weight: 600;">${reservation.name}</div>
                        <div style="font-size: 12px; color: #666;">${reservation.phone}</div>
                        ${reservation.notes ? `<div style="font-size: 11px; color: #888; margin-top: 2px;">üìù ${reservation.notes}</div>` : ''}
                    </td>
                    <td>
                        <span style="font-weight: 500;">${reservation.service}</span>
                    </td>
                    <td>
                        <div style="font-weight: 500;">${date}</div>
                        <div style="font-size: 12px; color: #666;">${reservation.time}</div>
                    </td>
                    <td><span class="status-badge ${statusClass}">${statusText[reservation.status]}</span></td>
                    <td>
                        ${reservation.status === 'pending' ? `
                            <button class="action-btn btn-confirm" onclick="updateStatus(${reservation.id}, 'confirmed')" title="Confirmar">‚úÖ</button>
                            <button class="action-btn btn-delete" onclick="updateStatus(${reservation.id}, 'cancelled')" title="Cancelar">‚ùå</button>
                        ` : ''}
                        ${reservation.status === 'confirmed' ? `
                            <button class="action-btn btn-confirm" onclick="updateStatus(${reservation.id}, 'completed')" title="Finalizar">üéâ</button>
                            <button class="action-btn btn-delete" onclick="updateStatus(${reservation.id}, 'cancelled')" title="Cancelar">‚ùå</button>
                        ` : ''}
                        <button class="action-btn btn-delete" onclick="deleteReservation(${reservation.id})" title="Excluir">üóëÔ∏è</button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        // Atualizar tabela de servi√ßos
        function updateServicesTable() {
            const tbody = document.getElementById('servicesTable');
            const services = salonData.services || [];
            
            if (services.length === 0) {
                tbody.innerHTML = '<tr><td colspan="4" class="empty-state"><div>‚ú® Nenhum servi√ßo cadastrado</div><div style="font-size: 12px; margin-top: 5px;">Adicione servi√ßos para aparecerem no chatbot</div></td></tr>';
                return;
            }
            
            tbody.innerHTML = '';
            services.forEach((service, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>
                        <div style="font-weight: 600;">${service.name}</div>
                    </td>
                    <td style="font-weight: 600; color: #28a745;">${service.price}</td>
                    <td>
                        <div style="font-size: 14px; color: #666;">${service.description}</div>
                    </td>
                    <td>
                        <button class="action-btn btn-edit" onclick="editService(${index})" title="Editar">‚úèÔ∏è</button>
                        <button class="action-btn btn-delete" onclick="deleteService(${index})" title="Excluir">üóëÔ∏è</button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        // Atualizar tabela de promo√ß√µes
        function updatePromotionsTable() {
            const tbody = document.getElementById('promotionsTable');
            const promotions = salonData.promotions || [];
            
            if (promotions.length === 0) {
                tbody.innerHTML = '<tr><td colspan="4" class="empty-state"><div>üéâ Nenhuma promo√ß√£o ativa</div><div style="font-size: 12px; margin-top: 5px;">Crie promo√ß√µes para atrair mais clientes</div></td></tr>';
                return;
            }
            
            tbody.innerHTML = '';
            promotions.forEach((promotion, index) => {
                const endDate = new Date(promotion.endDate);
                const today = new Date();
                const daysLeft = Math.ceil((endDate - today) / (1000 * 60 * 60 * 24));
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>
                        <div style="font-weight: 600;">${promotion.title}</div>
                        <div style="font-size: 12px; color: #666;">${promotion.description}</div>
                    </td>
                    <td style="font-weight: 600; color: #ff6b9d;">${promotion.discount}</td>
                    <td>
                        <div>${endDate.toLocaleDateString('pt-BR')}</div>
                        <div style="font-size: 12px; color: ${daysLeft > 0 ? '#28a745' : '#dc3545'};">
                            ${daysLeft > 0 ? `${daysLeft} dias restantes` : 'Expirada'}
                        </div>
                    </td>
                    <td>
                        <button class="action-btn btn-edit" onclick="editPromotion(${index})" title="Editar">‚úèÔ∏è</button>
                        <button class="action-btn btn-delete" onclick="deletePromotion(${index})" title="Excluir">üóëÔ∏è</button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        // Atualizar op√ß√µes de servi√ßos nos modais
        function updateServiceOptions() {
            const select = document.getElementById('reservationService');
            const services = salonData.services || [];
            
            select.innerHTML = '<option value="">Selecione um servi√ßo</option>';
            services.forEach(service => {
                const option = document.createElement('option');
                option.value = service.name;
                option.textContent = `${service.name} - ${service.price}`;
                select.appendChild(option);
            });
        }

        // Filtrar reservas
        function filterReservations() {
            const statusFilter = document.getElementById('statusFilter').value;
            const dateFilter = document.getElementById('dateFilter').value;
            const clientFilter = document.getElementById('clientFilter').value.toLowerCase();
            
            const allReservations = salonData.reservations || [];
            
            filteredReservations = allReservations.filter(reservation => {
                const statusMatch = !statusFilter || reservation.status === statusFilter;
                const dateMatch = !dateFilter || reservation.date === dateFilter;
                const clientMatch = !clientFilter || 
                    reservation.name.toLowerCase().includes(clientFilter) ||
                    reservation.phone.includes(clientFilter);
                
                return statusMatch && dateMatch && clientMatch;
            });
            
            updateReservationsTable();
        }

        // Sincronizar com chatbot
        function syncWithChatbot() {
            const chatbotActivity = localStorage.getItem('last_chatbot_activity');
            const dashboardActivity = localStorage.getItem('last_dashboard_activity');
            
            if (chatbotActivity && (!dashboardActivity || parseInt(chatbotActivity) > parseInt(dashboardActivity))) {
                console.log('üîÑ Sincronizando dados do chatbot...');
                loadData();
                updateAll();
            }
        }

        // Fun√ß√µes dos modais
        function openApiModal() {
            document.getElementById('apiModal').classList.add('show');
        }

        function openReservationModal() {
            clearReservationForm();
            document.getElementById('reservationDate').min = new Date().toISOString().split('T')[0];
            document.getElementById('reservationModal').classList.add('show');
        }

        function openServiceModal() {
            clearServiceForm();
            document.getElementById('serviceModal').classList.add('show');
        }

        function openPromotionModal() {
            clearPromotionForm();
            document.getElementById('promotionEndDate').min = new Date().toISOString().split('T')[0];
            document.getElementById('promotionModal').classList.add('show');
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('show');
        }

        // Limpar formul√°rios
        function clearReservationForm() {
            document.getElementById('reservationName').value = '';
            document.getElementById('reservationPhone').value = '';
            document.getElementById('reservationService').value = '';
            document.getElementById('reservationDate').value = '';
            document.getElementById('reservationTime').value = '';
            document.getElementById('reservationNotes').value = '';
        }

        function clearServiceForm() {
            document.getElementById('serviceName').value = '';
            document.getElementById('servicePrice').value = '';
            document.getElementById('serviceDescription').value = '';
        }

        function clearPromotionForm() {
            document.getElementById('promotionTitle').value = '';
            document.getElementById('promotionDiscount').value = '';
            document.getElementById('promotionDescription').value = '';
            document.getElementById('promotionEndDate').value = '';
        }

        // Salvar configura√ß√µes gerais
        function saveGeneralConfig() {
            const name = document.getElementById('salonName').value.trim();
            const address = document.getElementById('salonAddress').value.trim();
            const phone = document.getElementById('salonPhone').value.trim();
            
            if (!name || !address || !phone) {
                showNotification('Preencha todos os campos!', 'error');
                return;
            }
            
            salonData.name = name;
            salonData.address = address;
            salonData.phone = phone;
            
            if (saveData()) {
                showNotification('Configura√ß√µes salvas com sucesso!');
            }
        }

        // Salvar API key
        function saveApiKey() {
            const apiKey = document.getElementById('apiKey').value.trim();
            if (!apiKey) {
                showNotification('Por favor, insira uma API key!', 'error');
                return;
            }
            
            if (!apiKey.startsWith('sk-ant-')) {
                showNotification('API key inv√°lida! Deve come√ßar com "sk-ant-"', 'error');
                return;
            }
            
            localStorage.setItem('claude_api_key', apiKey);
            showNotification('API key salva com sucesso!');
            closeModal('apiModal');
            checkApiStatus();
            console.log('üîë API Key configurada');
        }

        // Salvar reserva
        function saveReservation() {
            const name = document.getElementById('reservationName').value.trim();
            const phone = document.getElementById('reservationPhone').value.trim();
            const service = document.getElementById('reservationService').value;
            const date = document.getElementById('reservationDate').value;
            const time = document.getElementById('reservationTime').value;
            const notes = document.getElementById('reservationNotes').value.trim();
            
            if (!name || !phone || !service || !date || !time) {
                showNotification('Preencha todos os campos obrigat√≥rios!', 'error');
                return;
            }
            
            const reservation = {
                id: Date.now(),
                name, phone, service, date, time, notes,
                status: 'confirmed',
                createdAt: new Date().toISOString()
            };
            
            if (!salonData.reservations) {
                salonData.reservations = [];
            }
            
            salonData.reservations.push(reservation);
            
            if (saveData()) {
                updateAll();
                closeModal('reservationModal');
                showNotification('Reserva criada com sucesso!');
            }
        }

        // Salvar servi√ßo
        function saveService() {
            const name = document.getElementById('serviceName').value.trim();
            const price = document.getElementById('servicePrice').value.trim();
            const description = document.getElementById('serviceDescription').value.trim();
            
            if (!name || !price || !description) {
                showNotification('Preencha todos os campos!', 'error');
                return;
            }
            
            const service = { name, price, description };
            
            if (!salonData.services) {
                salonData.services = [];
            }
            
            salonData.services.push(service);
            
            if (saveData()) {
                updateAll();
                closeModal('serviceModal');
                showNotification('Servi√ßo criado com sucesso!');
            }
        }

        // Salvar promo√ß√£o
        function savePromotion() {
            const title = document.getElementById('promotionTitle').value.trim();
            const discount = document.getElementById('promotionDiscount').value.trim();
            const description = document.getElementById('promotionDescription').value.trim();
            const endDate = document.getElementById('promotionEndDate').value;
            
            if (!title || !discount || !description || !endDate) {
                showNotification('Preencha todos os campos!', 'error');
                return;
            }
            
            const promotion = { title, discount, description, endDate };
            
            if (!salonData.promotions) {
                salonData.promotions = [];
            }
            
            salonData.promotions.push(promotion);
            
            if (saveData()) {
                updateAll();
                closeModal('promotionModal');
                showNotification('Promo√ß√£o criada com sucesso!');
            }
        }

        // Atualizar status da reserva
        function updateStatus(id, newStatus) {
            const reservation = salonData.reservations.find(r => r.id === id);
            if (reservation) {
                reservation.status = newStatus;
                if (saveData()) {
                    updateAll();
                    const statusText = {
                        'confirmed': 'confirmada',
                        'completed': 'finalizada',
                        'cancelled': 'cancelada'
                    };
                    showNotification(`Reserva ${statusText[newStatus]}!`);
                }
            }
        }

        // Excluir reserva
        function deleteReservation(id) {
            const reservation = salonData.reservations.find(r => r.id === id);
            if (!reservation) return;
            
            if (confirm(`Tem certeza que deseja excluir a reserva de ${reservation.name}?`)) {
                salonData.reservations = salonData.reservations.filter(r => r.id !== id);
                if (saveData()) {
                    updateAll();
                    showNotification('Reserva exclu√≠da!');
                }
            }
        }

        // Editar/Excluir servi√ßos
        function editService(index) {
            const service = salonData.services[index];
            if (!service) return;
            
            document.getElementById('serviceName').value = service.name;
            document.getElementById('servicePrice').value = service.price;
            document.getElementById('serviceDescription').value = service.description;
            
            salonData.services.splice(index, 1);
            openServiceModal();
        }

        function deleteService(index) {
            const service = salonData.services[index];
            if (!service) return;
            
            if (confirm(`Tem certeza que deseja excluir o servi√ßo "${service.name}"?`)) {
                salonData.services.splice(index, 1);
                if (saveData()) {
                    updateAll();
                    showNotification('Servi√ßo exclu√≠do!');
                }
            }
        }

        // Editar/Excluir promo√ß√µes
        function editPromotion(index) {
            const promotion = salonData.promotions[index];
            if (!promotion) return;
            
            document.getElementById('promotionTitle').value = promotion.title;
            document.getElementById('promotionDiscount').value = promotion.discount;
            document.getElementById('promotionDescription').value = promotion.description;
            document.getElementById('promotionEndDate').value = promotion.endDate;
            
            salonData.promotions.splice(index, 1);
            openPromotionModal();
        }

        function deletePromotion(index) {
            const promotion = salonData.promotions[index];
            if (!promotion) return;
            
            if (confirm(`Tem certeza que deseja excluir a promo√ß√£o "${promotion.title}"?`)) {
                salonData.promotions.splice(index, 1);
                if (saveData()) {
                    updateAll();
                    showNotification('Promo√ß√£o exclu√≠da!');
                }
            }
        }

        // Abrir chatbot
        function openChatbot() {
            const apiKey = localStorage.getItem('claude_api_key');
            if (!apiKey || !apiKey.startsWith('sk-ant-')) {
                showNotification('Configure a API do Claude primeiro!', 'warning');
                openApiModal();
                return;
            }
            
            showNotification('Abra o arquivo do chatbot em uma nova aba!');
        }

        // Mostrar notifica√ß√£o
        function showNotification(message, type = 'success') {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = `notification ${type}`;
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 4000);
        }

        // Fechar modais ao clicar fora
        document.addEventListener('click', function(e) {
            if (e.target.classList.contains('modal')) {
                e.target.classList.remove('show');
            }
        });

        // Atalhos de teclado
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                const openModal = document.querySelector('.modal.show');
                if (openModal) {
                    openModal.classList.remove('show');
                }
            }
        });
    </script>
</body>
</html>